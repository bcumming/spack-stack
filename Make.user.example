# vim: filetype=make

# Copy this file to Make.user and set some variables.

# This is the root of the software stack directory.
SOFTWARE_STACK_PROJECT := $(dir $(abspath $(lastword $(MAKEFILE_LIST))))

# What Spack should we use?
SPACK := spack

# The Spack installation root.
STORE := /user-environment

# Build in memory on /dev/shm/store, but bind it to /user-environment.
BWRAP := $(SOFTWARE_STACK_PROJECT)/bwrap-mutable-root.sh --tmpfs /tmp --tmpfs ~ --bind /dev/shm/store $(STORE)

# Makes sure that make -Orecurse continues to print in color.
export SPACK_COLOR := always

# Look for compilers.yaml / packages.yaml in this directory. 
export SPACK_USER_CONFIG_PATH := $(SOFTWARE_STACK_PROJECT)/config/<name>

# Put clingo and friends here...
export SPACK_USER_CACHE_PATH := $(SOFTWARE_STACK_PROJECT)/cache

# Output the full build log to stdout.
# export SPACK_INSTALL_FLAGS := --verbose

# Reproducibility
export LC_ALL := C
export TZ := UTC

# I tried UNIX epoch 0 here, but it results in build errors with Python
# packages using wheels, since they rely on zipfiles, and zipfiles can only
# handle DOS epoch, which is the magic number below (1980-01-01).
export SOURCE_DATE_EPOCH := 315576060
